# 鸡蛋期货季节性回归策略

## 策略概述

基于鸡蛋期货的季节性价格规律，使用两根基准线（夏季低价线和冬季高价线）进行均值回归交易的量化策略。

### 核心思想
- **季节性规律**：鸡蛋价格6-8月较低，11-1月较高
- **两根直线**：基于去年夏冬季均价构建低价线和高价线
- **均值回归**：价格偏离基准线时开仓，回归时平仓
- **避免换仓**：通过智能合约选择，完全避免换仓成本

## 策略架构

### 1. 数据基础
- **数据源**：AKShare获取的鸡蛋期货日线数据
- **合约范围**：JD2101-JD2512（2021-2025年所有合约）
- **数据频率**：日线数据（足够捕获季节性规律）

### 2. 主力合约选择
基于期货市场实际规律，而非简单按成交量选择：

#### 理论主力合约规则
- **成为主力**：距离交割60天左右
- **失去主力**：距离交割30天以内
- **强制平仓**：距离交割15天前必须平仓

#### 合约选择逻辑
```python
def get_theoretical_main_contract(self, current_date):
    # 1. 生成未来12个月合约
    # 2. 筛选距离交割30-90天的合约
    # 3. 选择最接近60天的合约作为理论主力
    # 4. 如无数据则按成交量选择备选
```

### 3. 价格基准线构建

#### 两根直线系统
1. **低价线**：基于去年夏季（6-8月）均价
2. **高价线**：基于去年冬季（11-1月）均价

#### 价格调整机制
```python
# 根据今年已有数据计算调整系数
adjustment = 今年均价 / 去年同期均价
# 限制调整幅度在0.8-1.2之间
low_line = 去年夏季均价 * adjustment
high_line = 去年冬季均价 * adjustment
```

### 4. 交易信号生成

#### 开仓信号
- **做多条件**：当前价格接近或低于低价线
- **做空条件**：当前价格接近或高于高价线
- **阈值控制**：`open_threshold`参数控制开仓敏感度

#### 平仓信号
- **多头平仓**：价格回升接近高价线
- **空头平仓**：价格回落接近低价线
- **止损平仓**：亏损超过`stop_loss`比例

#### 趋势过滤（顺大势逆小势）
- **6-10月**：上涨趋势季节，不开空仓
- **11-5月**：下跌趋势季节，不开多仓

### 5. 风险管理

#### 仓位控制
- **最大仓位**：`max_position_ratio`控制单次最大仓位比例
- **保证金管理**：按15%保证金率计算所需资金
- **动态调整**：根据资金情况动态调整手数

#### 风险控制
- **止损机制**：固定比例止损
- **交割风险**：距离交割15天前强制平仓
- **流动性控制**：优选理论主力合约，避免流动性风险

## 策略参数

### 核心参数配置
```python
strategy_config = {
    # 开平仓阈值
    'open_threshold': 0.02,      # 开仓阈值 (建议范围: 0.01-0.05)
    'close_threshold': 0.04,     # 平仓阈值 (建议范围: 0.02-0.06)
    
    # 风险控制
    'stop_loss': 0.10,           # 止损比例 (建议范围: 0.08-0.15)
    'max_position_ratio': 0.5,   # 最大仓位比例 (建议范围: 0.3-0.6)
    
    # 策略特性
    'enable_trend_filter': True, # 是否启用趋势过滤
}
```

### 参数说明
- **open_threshold**：价格偏离基准线多少比例时开仓，越小越敏感
- **close_threshold**：价格回归多少比例时平仓，越大越保守
- **stop_loss**：最大亏损比例，超过则强制止损
- **max_position_ratio**：单次最大仓位占总资金比例
- **enable_trend_filter**：是否启用季节性趋势过滤

## 策略优势

### 1. 零换仓成本
- **智能合约选择**：基于交割时间选择合约，避免频繁换仓
- **成本节约**：完全避免换仓带来的价差损失和手续费

### 2. 符合市场规律
- **季节性特征**：充分利用鸡蛋价格的季节性规律
- **合约生命周期**：遵循期货合约的自然生命周期
- **流动性优化**：选择流动性最好的合约交易

### 3. 风险可控
- **明确止损**：固定比例止损，风险可量化
- **交割保护**：提前平仓避免交割风险
- **趋势过滤**：避免逆大趋势交易

### 4. 策略透明
- **逻辑清晰**：基于两根直线的简单逻辑
- **参数可调**：所有关键参数都可配置优化
- **可视化**：提供完整的策略图表分析

## 使用方法

### 1. 环境准备
```bash
# 安装依赖
pip install pandas numpy matplotlib akshare

# 激活环境
source tianqin_test_env/bin/activate
```

### 2. 数据获取
```bash
# 获取最新数据
python get_futures_data.py
```

### 3. 策略运行
```bash
# 运行策略
python jd_seasonal_regression_strategy.py
```

### 4. 参数优化
在策略文件顶部的配置区域调整参数：
```python
# 🎯 核心策略参数 (可自由调整优化)
strategy_config = {
    'open_threshold': 0.02,      # 调整这里
    'close_threshold': 0.04,     # 调整这里
    'stop_loss': 0.10,           # 调整这里
    'max_position_ratio': 0.5,   # 调整这里
    'enable_trend_filter': True, # 调整这里
}
```

## 策略输出

### 1. 交易记录
- 详细的开仓、平仓记录
- 盈亏情况和平仓原因
- 合约选择和交割天数信息

### 2. 绩效指标
- **收益率**：总收益和年化收益
- **胜率**：盈利交易占比
- **夏普比率**：风险调整后收益
- **最大回撤**：基于日线高低价的精确计算

### 3. 可视化图表
- **价格走势**：鸡蛋价格与两根基准线
- **交易点位**：开仓平仓点的标记
- **资金曲线**：总资产变化趋势
- **交易区间**：两根线之间的交易区间

## 注意事项

### 1. 数据质量
- 确保使用完整的历史数据（包含2021年近月合约）
- 定期更新数据以获得最新的市场信息

### 2. 参数调优
- 建议通过历史回测优化参数组合
- 不同市场环境可能需要不同的参数设置

### 3. 实盘考虑
- 策略基于日线数据，适合中长期持仓
- 实盘交易需考虑滑点、手续费等实际成本
- 需要监控合约交割时间，及时调整持仓

### 4. 风险提示
- 期货交易具有高风险，可能导致本金损失
- 策略基于历史规律，未来表现可能与历史不符
- 建议充分测试后再进行实盘交易

## 版本历史

### v2.0 (2025-09-12)
- 重构主力合约选择逻辑，基于交割时间而非成交量
- 实现完全零换仓的策略设计
- 添加智能合约生命周期管理
- 优化风险控制机制
- 提供完整的可视化分析

### v1.0 (2025-09-11)
- 初始版本，基于换仓的季节性策略
- 存在高换仓成本问题（已解决）

---

**策略作者**：量化交易团队  
**最后更新**：2025年9月12日  
**策略状态**：已优化，可用于回测和实盘参考
